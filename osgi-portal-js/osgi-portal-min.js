"use strict";window.MbyUtils=window.MbyUtils||{};(function(a,d){var e=function(l){if(String.prototype.trim){return l===null?"":String.prototype.trim.call(l)}else{var k=/^\s+/,j=/\s+$/;return l===null?"":l.toString().replace(k,"").replace(j,"")}};var b=function(j){return(j===null)};var f=function(j){return(typeof j==="undefined")};var h=function(j){return b(j)||f(j)};var i=function(j){if(typeof j==="object"&&j!==null){return(typeof j.valueOf()==="number")}else{return(typeof j==="number")}};var c=function(j){return j&&Object.prototype.toString.call(j)==="[object Function]"};var g=function(j){return j&&Object.prototype.toString.call(j)==="[object Array]"};a.Tools={trim:e,isNull:b,isUndefined:f,isNullOrUndefined:h,isNumber:i,isFunction:c,isArray:g}})(window.MbyUtils);if(!Array.prototype.indexOf){Array.prototype.indexOf=function(c){if(this==null){throw new TypeError()}var d=Object(this);var a=d.length>>>0;if(a===0){return -1}var e=0;if(arguments.length>1){e=Number(arguments[1]);if(e!=e){e=0}else{if(e!=0&&e!=Infinity&&e!=-Infinity){e=(e>0||-1)*Math.floor(Math.abs(e))}}}if(e>=a){return -1}var b=e>=0?e:Math.max(a-Math.abs(e),0);for(;b<a;b++){if(b in d&&d[b]===c){return b}}return -1}}Array.prototype.remove=function(a){var b=this.indexOf(a);if(b!==-1){this.splice(b,1);return true}return false};Array.prototype.contains=function(c){var a=false,b;b=this.indexOf(c);if(b!==-1){a=true}return a};"use strict";window.MbyUtils=window.MbyUtils||{};(function(e,c,f){var a=["log","debug","info","warn","error","assert","dir","dirxml","group","groupEnd","time","timeEnd","count","trace","profile","profileEnd"];var d=false;function b(){var j;if(c.Tools.isNullOrUndefined(e.console)){e.console={}}j=e.console;var h=function(){};for(var l=0;l<a.length;++l){var k=j[a[l]];if(d||c.Tools.isNullOrUndefined(k)){j[a[l]]=h}}return j}var g=b();e.log=function(h){g.log(h)};e.debug=function(h){g.debug(h)};e.info=function(h){g.info(h)};e.warn=function(h){g.warn(h)};e.error=function(h){g.error(h)};c.Logger={log:e.log,debug:e.debug,info:e.info,warn:e.warn,error:e.error}})(window,window.MbyUtils);Array.prototype.remove=function(a){var b=this.indexOf(a);if(b!==-1){this.splice(b,1);return true}return false};Array.prototype.contains=function(c){var a=false,b;b=this.indexOf(c);if(b!==-1){a=true}return a};"use strict";window.MbyUtils=window.MbyUtils||{};(function(b,c){var a=function(d,e){if(!d){throw"MbyUtils.event.Event builder need a topic !"}if(e&&(typeof e!=="object")){throw"Event properties need to be an Object !"}this.topic=d;this.properties=e||{}};a.prototype.toString=function(){return"[Event#"+this.topic+" properties: "+this.properties+"]"};b.event=b.event||{};b.event.Event=a})(window.MbyUtils);"use strict";var Tools=window.MbyUtils.Tools;window.MbyUtils=window.MbyUtils||{};(function(a,c){var b=function(d,e){if(!d){throw"MbyUtils.event.EventListener builder need a topic !"}if(e&&!Tools.isFunction(e)){throw"MbyUtils.event.EventListener builder need a function as callback !"}this.topic=d;this.callback=e};b.prototype.isTopic=function(d){return this.topic===d};b.prototype.toString=function(){return"[EventListener#"+this.topic+"]"};a.event=a.event||{};a.event.EventListener=b})(window.MbyUtils);"use strict";window.MbyUtils=window.MbyUtils||{};(function(b,d){var a=b.Tools;var e=function(f){if(!f){throw"MbyUtils.event.EventTarget builder need a name !"}this.name=f;this.listenersByTopic={}};e.prototype.addEventListener=function(f){if(!f){throw"Trying to add null or undefined EventListener in "+this+" !"}if(f.callback&&!a.isFunction(f.callback)){throw"Trying to add eventListener with invalid callback in "+this+" !"}var g=f.topic;var h=this.listenersByTopic[g];if(!h){h=[];this.listenersByTopic[g]=h}h.push(f);console.log("EventListener "+f+" registered in "+this+" .")};e.prototype.removeEventListener=function(f){if(!f){throw"Trying to remove null or undefined EventListener in "+this+" !"}var g=f.topic;var h=this.listenersByTopic[g];var i=false;if(h){i=h.remove(f)}if(i){console.log("EventListener "+f+" unregistered from "+this+" .")}else{throw"EventListener "+f+" not found in "+this+" !"}};e.prototype.fireEvent=function(j){if(!j){throw"Trying to fire null or undefined Event on "+this+" !"}var h=j.topic;var i=this.listenersByTopic[h];c(this,j,i);var g=[];for(var f in this.listenersByTopic){if(f!==h){var k=new RegExp(f);if(k.test(h)){g=g.concat(this.listenersByTopic[f])}}}c(this,j,g)};function c(j,h,g){if(g){for(var f=0;f<g.length;++f){var i=g[f];if(i&&a.isFunction(i.callback)){console.debug(j+" firing "+h+" on "+i+".");i.callback(h)}}}}e.prototype.toString=function(){return"[EventTarget#"+this.name+"]"};b.event=b.event||{};b.event.EventTarget=e})(window.MbyUtils);"use strict";window.OsgiPortal=window.OsgiPortal||{};(function(a,c){var b=function(f,e,d){if(!f){throw"Action appClient need to be supplied !"}if(!e){throw"OsgiPortal.model.Action builder need a type !"}if(d&&typeof d!=="object"){throw"Action properties need to be an Object !"}this.type=e;this.properties=d||{};this.appClient=f};b.prototype.isType=function(d){return this.type===d};b.prototype.toString=function(){return"[Action#"+this.type+" properties: "+this.properties+" from "+this.appClient+"]"};a.model=a.model||{};a.model.Action=b})(window.OsgiPortal);"use strict";window.OsgiPortal=window.OsgiPortal||{};(function(a,c){var b=function(f,e,d){if(!f||!e||!d){throw"OsgiPortal.model.App builder need an id, a symbolic name and a version !"}this.id=f;this.symbolicName=e;this.version=d;this.eventWiring=[]};b.prototype.toString=function(){return"[App#"+this.id+" symbolicName: "+this.symbolicName+" ; version: "+this.version+"]"};a.model=a.model||{};a.model.App=b})(window.OsgiPortal);"use strict";var MbyUtils=window.MbyUtils;window.OsgiPortal=window.OsgiPortal||{};(function(b,e,g){var c=e.Tools;var a=e.event.Event;var d=b.model.Action;var f=function(i,j,h){if(!i||!j||!h){throw"OsgiPortal.model.AppClient builder need the OsgiPortal ref, the App ref name and a signature !"}this.osgiPortal=i;this.appId=j.id;this.signature=h;this.replyHooks=[];this.appEventListeners=null};f.prototype.registerAppEventHook=function(h,i,k){if(!c.isFunction(k)){throw"Cannot register App Event Hook : supplied Hook is not a function !"}if(!this.appEventListeners){throw"This AppClient is not authorized to register EventHooks !"}if(!this.appEventListeners[h]){throw"This AppClient is not authorized to register EventHooks on App with symbolicName: ["+h+"] !"}if(!this.appEventListeners[h][i]){throw"This AppClient is not authorized to register EventHooks on App with symbolicName: ["+h+"] for topic: ["+i+"] !"}var j=this.appEventListeners[h][i];if(j.callback){console.log("Replacing "+this+" app event hook on App with symbolicName: ["+h+"] for topic: ["+i+"].")}j.callback=k};f.prototype.registerReplyHook=function(h,i){if(!c.isFunction(i)){throw"Cannot register Reply Hook : supplied Hook is not a function !"}var j=this.replyHooks[h];if(j){throw"Replacing "+this+" reply hook for type: ["+h+"]."}this.replyHooks[h]=i};f.prototype.fireEvent=function(h,i){this.osgiPortal.fireEventFromAppClient(this,new a(h,i))};f.prototype.doAction=function(i,h){this.osgiPortal.doActionFromAppClient(new d(this,i,h))};f.prototype.alert=function(h){this.osgiPortal.fireEventFromAppClient(this,new a("alert",{message:h}))};f.prototype.toString=function(){return"[AppClient#"+this.appId+"]"};b.model=b.model||{};b.model.AppClient=f})(window.OsgiPortal,MbyUtils);"use strict";window.OsgiPortal=window.OsgiPortal||{};(function(b,c){var a=function(e,d){if(!e){throw"OsgiPortal.model.Reply builder need a type !"}if(d&&typeof d!=="object"){throw"Reply properties need to be an Object !"}this.type=e;this.properties=d||{}};a.prototype.isType=function(d){return this.type===d};a.prototype.toString=function(){return"[Reply#"+this.type+" properties: "+this.properties+"]"};b.model=b.model||{};b.model.Reply=a})(window.OsgiPortal);"use strict";window.OsgiPortal=window.OsgiPortal||{};(function(i,f){var g=MbyUtils.Tools;var j=MbyUtils.event.Event;var k=MbyUtils.event.EventTarget;var a=MbyUtils.event.EventListener;var b=i.model.Reply;var h=function(p){if(!p){throw"No configuration supplied to PortalContext !"}this.portalEventHooks={};this.portalActionHooks=new k("Portal Action hooks");this.registeredApps={};this.registeredAppClients={};this.appEventTargets={};var m=p.eventHooks;if(!m){m={}}this.portalEventHooks=m;var l=p.actionHooks;if(!l){l={}}for(var n in l){if(l.hasOwnProperty(n)){var o=l[n];if(!g.isFunction(o)){throw"Configured Portal Action hook for type "+n+" is not a function !"}d(this,n,o)}}};h.prototype.getRegisteredAppById=function(l){var m=this.registeredApps[l];if(!m){return null}return m};h.prototype.getRegisteredAppBySymbolicName=function(l){for(var m in this.registeredApps){if(this.registeredApps.hasOwnProperty(m)){var n=this.registeredApps[m];if(n&&n.symbolicName===l){return n}}}return null};h.prototype.getRegisteredAppClientById=function(l){var m=this.registeredAppClients[l];if(!m){return null}return m};h.prototype.getAppEventTarget=function(l){var m=this.appEventTargets[l];if(!m){m=new k("App sn:["+l+"]");this.appEventTargets[l]=m}return m};h.prototype.registerApp=function(p,z){if(!p){throw"No App supplied for registration in PortalContext"}if(p.id!==z.appId){throw"App and its client does not share the same appId !"}var o=this.registeredApps[p.id];if(o){throw p+" already registered !"}this.registeredApps[p.id]=p;console.log(p+" registered in PortalContext.");var v=this.getAppEventTarget(p.symbolicName);for(var y in this.portalEventHooks){if(this.portalEventHooks.hasOwnProperty(y)){var n=this.portalEventHooks[y];if(n&&g.isFunction(n)){var x=new a(y,n);v.addEventListener(x);console.log("Portal EventHook#"+y+" registered on "+p+".")}else{console.log("Portal EventHook#"+y+" is not defined !")}}}if(!z){throw"No AppClient supplied for registration in PortalContext"}var s=this.registeredAppClients[z.appId];if(s){throw z+" already registered !"}this.registeredAppClients[z.appId]=z;console.log(z+" registered in PortalContext.");for(var q=0;q<p.eventWiring.length;++q){var u=p.eventWiring[q];var t=u.topic;var l=u.symbolicName;if(!t||!l){throw"Event wiring need to contain a property 'symbolicName' and a property 'topic' !"}var m=this.getAppEventTarget(l);var r=new a(t,null);m.addEventListener(r);var w=z.appEventListeners;if(!w){w=[];z.appEventListeners=w}if(!w[l]){w[l]=[];z.appEventListeners[l]=w[l]}z.appEventListeners[l][t]=r;console.log(p+" wiring configured to listen App with sn: ["+l+"] on topic: ["+t+"].")}};h.prototype.unregisterApp=function(o){var n=o.id;var m=this.getRegisteredAppClientById(n);if(m){this.registeredApps[n]=null;console.log(m+" unregistered.")}else{throw o+" wasn't previously registered !"}var l=this.getRegisteredAppClientById(n);if(l){this.registeredAppClients[n]=null;console.log(l+" unregistered.")}else{throw appClient+" wasn't previously registered !"}};h.prototype.unregisterAppById=function(l){var m=this.getRegisteredAppById(l);this.unregisterApp(m)};h.prototype.fireEventFromAppClient=function(q,n){var m=this;e(m,q);var p=this.getRegisteredAppById(q.appId);var o=p.symbolicName;n.properties.sourceSymbolicName=o;n.properties.sourceVersion=p.version;var l=this.getAppEventTarget(o);l.fireEvent(n)};h.prototype.doActionFromAppClient=function(n){var l=this;var p=n.appClient;e(l,p);console.log(n+" in progress ...");var o=this.getRegisteredAppById(p.appId);n.properties.sourceSymbolicName=o.symbolicName;n.properties.sourceVersion=o.version;var m=new j(n.type,{action:n});this.portalActionHooks.fireEvent(m)};function c(m,o,l){var q=m.getRegisteredAppClientById(o);if(!q){throw"No AppClient found for appId#"+o+" to send a reply to !"}var n=l.type;var p=q.replyHooks[n];if(p){if(!g.isFunction(p)){throw"Configured "+q+" Reply hook for type "+n+" is not a function !"}console.log("Calling Reply hook for type "+n+" on "+q+" ...");p(l)}else{console.log("No Hook registered for incoming "+l+" to "+q+".")}}function e(n,p){if(!p){throw"AppClient is null or undefined !"}var o=p.appId;var l=n.getRegisteredAppClientById(o);if(!l){throw"No AppClient registered with Id: "+o+" !"}if(l!==p){throw"AppClient was not built by the OsgiPortal !"}var m=n.getRegisteredAppById(o);if(!m){throw"AppClient refer to an unknown App !"}}function d(n,l,m){console.log("Registering Action hook for type: "+l+" ...");var o=new a(l,function(t){var r=t.properties;var s=r.action;var q=s.appClient.appId;var p=function(w,u,v){v=v||q;c(n,v,new b(w,u))};console.log("calling Action hook for type: "+l);m(s,p)});n.portalActionHooks.addEventListener(o)}i.model=i.model||{};i.model.PortalContext=h})(window.OsgiPortal);"use strict";var Tools=window.MbyUtils.Tools;window.OsgiPortal=window.OsgiPortal||{};(function(b,g){var f=b.model.AppClient;var h=b.model.PortalContext;var a=null;var d=null;function c(i){if(!a&&i){a=e(i)}else{if(i){console.log("WARN: OsgiPortal is already configured !")}}return a}function e(k){if(!k){throw"No OSGi Portal configuration supplied for OsgiPortal initialization !"}var p=k.appLoadingHook;if(!p||!Tools.isFunction(p)){throw"OSGi Portal configuration need an 'appLoadingHook' to be able to load App by signature !"}d=p;var l=new h(k);function j(q){var s=i(q);var r=new f(a,s,q);l.registerApp(s,r);return r}function o(q){var s=i(q);var r=l.getRegisteredAppClientById(s.id);return r}function i(q){var r=d(q);if(!r){throw"App loading Hook didn't return an App !"}return r}function m(r,q){l.fireEventFromAppClient(r,q)}function n(q){l.doActionFromAppClient(q)}return{registerPortalApplication:function(q){return j(q)},loadPortalApplication:function(q){return o(q)},doActionFromAppClient:function(q){n(q)},fireEventFromAppClient:function(r,q){m(r,q)}}}b.getInstance=function(i){return c(i)}})(window.OsgiPortal);